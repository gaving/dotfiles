#!/bin/zsh
# zsh aliases

# general

alias :q='exit'
alias :wq='exit'
alias a='ack -i'
alias e='print -l **/*'
alias h='history'
alias g='git'
alias u='uptime'
alias v='vim'
alias x='extract'

for c in cp rm mv chmod chown rename; do
    alias $c="nocorrect $c -v"
done

for c in alias expr find wget which; do
    alias $c="noglob $c"
done

alias egrep='egrep -I --color=auto'
alias grep='grep -I --color=auto'
alias less='less -iM'
alias man='nocorrect man'
alias mirror="noglob wget --mirror --no-parent --recursive --timestamping --continue --recursive"
alias mkdir='nocorrect mkdir -p'
alias mmv='noglob zmv -W'
alias myip='curl http://ifconfig.me/ip'
alias path='echo -e ${PATH//:/\\n}'
alias po="popd"
alias psg="ps aux | grep"
alias pu="pushd"
alias rscp="nocorrect rsync -aP --no-whole-file --inplace"
alias rsmv="nocorrect rscp --remove-source-files"
alias sudo="sudo " # allow alias expansion
alias trail="tail -n 300 -f"
alias tree='tree --noreport --dirsfirst -FCshu'

if which htop >/dev/null; then
    alias top='htop --sort-key PERCENT_CPU'
fi

# Make head/tail output fill screen
alias head='head -n $((LINES-2))'
alias tail='tail -n $((LINES-2))'

# zmv

alias zcp='zmv -C'
alias zln='zmv -L'

# python

alias web='python -m SimpleHTTPServer'

# typos

alias xs='cd'
alias vf='cd'
alias cd..='cd ..'

# global

alias -g V='| vim'
alias -g L='| less -REF'
alias -g M='| more'
alias -g H='| head'
alias -g T='| tail'
alias -g G='| grep'
alias -g C='| wc -l'
alias -g S='| sort'
alias -g A='&> /dev/null | at'
alias -g DN='&> /dev/null'

if which pbcopy >/dev/null 2>&1 ; then
    alias -g X='| pbcopy'
elif which xsel >/dev/null 2>&1 ; then
    alias -g X='| xsel --input --clipboard'
elif which putclip >/dev/null 2>&1 ; then
    alias -g X='| putclip'
fi

# suffix

alias -s htm=${BROWSER:-lynx}
alias -s html=${BROWSER:-lynx}
alias -s tex=${EDITOR:-vim}
alias -s txt=${PAGER:-less}

for c in bz2 gz tar zip tgz; do
    alias -s $c=show-archive
done

# chmod

alias rw-='chmod 600'
alias rwx='chmod 700'
alias r--='chmod 644'
alias r-x='chmod 755'

# ls

typeset -A lsMap
lsMap[lsa]='show hidden'
lsMap[lsb]='display the biggest files'
lsMap[lsc]='sort by change time'
lsMap[lsd]='only show directories'
lsMap[lse]='only show empty directories'
lsMap[lsk]='sort by size'
lsMap[lsl]='pipe through less'
lsMap[lsn]='display the newest files'
lsMap[lso]='display the oldest files'
lsMap[lsr]='recursive ls'
lsMap[lss]='display the smallest files'
lsMap[lst]='sort by date'
lsMap[lsu]='sort by access time'
lsMap[lsx]='sort by extension'
ls_() { for i in ${(k)lsMap}; printf "%s - %s\n" $i $lsMap[$i] }
alias ls?=ls_

# compatibility check for --group-directories-first
ls --group-directories-first -d . >/dev/null 2>&1 && gdf=--group-directories-first

alias ls="ls -hFG --color=auto $gdf"
alias lsa='ls -Al'                 # show hidden files
alias lsb='ls -flh *(.OL[1,10])'   # display the biggest files
alias lsc='ls -lcr'                # sort by change time
alias lsd='ls -d *(/)'             # only show directories
alias lse='ls -d *(/^F)'           # only show empty directories
alias lsk='ls -lSr'                # sort by size
alias lsl='ls -Al L'               # pipe through 'less'
alias lsn='ls -rl *(D.om[1,10])'   # display the nest files
alias lso='ls -rtlh *(D.om[1,10])' # display the oldest files
alias lsr='ls -lR'                 # recursive ls
alias lss='ls -Srl *(.oL[1,10])'   # display the smallest files
alias lst='ls -ltr'                # sort by date
alias lsu='ls -lur'                # sort by access time
alias lsx='ls -lXB'                # sort by extension

# du

alias du='du -kh'
alias duh='du -slh'
alias dub='du -slb'
alias duk='du -slk'
alias dum='du -slm'
alias dug='du -sl --block-size=1G'
alias duf='du -sk * | sort -n | perl -ne '\''($s,$f)=split(m{\t});for (qw(K M G)) {if($s<1024) {printf("%.1f",$s);print "$_\t$f"; last};$s=$s/1024}'\'

# df

alias df='df -kh'
alias dfh='df -PTh'
alias dfb='df -PT --block-size=1'
alias dfk='df -PTk'
alias dfm='df -PTm'
alias dfg='df -PT --block-size=1G'

# git

alias gb='git branch'
alias gba='git branch -a'
alias gc='git commit -v'
alias gca='git commit -v -a'
alias gco='git checkout'
alias gd='git diff'
alias gds='git diff --staged'
alias gdm='git diff HEAD\^..master'
alias gl='git pull'
alias gp='git push'
alias gpcd='git push && cap deploy'
alias grm="git status | grep deleted | awk '{print \$3}' | xargs git rm"
alias gs='git status'

alias gsa="git submodule add"
alias gsu="git submodule foreach git pull origin master"

# gpg

alias encrypt='gpg --encrypt-files --default-recipient-self'
alias decrypt='gpg --decrypt-files'
